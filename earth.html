<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3D Earth • Aditya S</title>

  <!-- use your existing stylesheet for site chrome -->
  <link rel="stylesheet" href="style.css">

  <style>
    /* local styles for the 3D page */
    :root { --bg: #007BFF; --ui-white: #fff; }
    body.about-page { margin:0; height:100vh; background:var(--bg); color:var(--ui-white); overflow:hidden; }

    .top-ui {
      position: absolute;
      top: 18px;
      left: 18px;
      z-index: 10;
      display:flex;
      gap:12px;
      align-items:center;
    }

    .back-button {
      display:inline-block;
      text-decoration:none;
      color:var(--ui-white);
      border:2px solid var(--ui-white);
      padding:6px 12px;
      border-radius:8px;
      font-family: 'MyCustomFont', sans-serif;
      transition: .16s;
    }
    .back-button:hover { background:var(--ui-white); color:var(--bg); }

    .label {
      color:var(--ui-white);
      font-family: 'MyCustomFont', sans-serif;
      font-size: 14px;
      opacity:0.95;
      border: 2px solid rgba(255,255,255,0.08);
      padding:6px 10px;
      border-radius:8px;
      backdrop-filter: blur(4px);
    }

    /* full screen canvas container */
    #canvas-container {
      width: 100vw;
      height: 100vh;
    }

    /* small responsive tweaks */
    @media (max-width:700px) {
      .label { font-size: 12px; padding:5px 8px; }
      .back-button { padding:5px 10px; font-size:14px; }
    }
  </style>
</head>
<body class="about-page">

  <div class="top-ui">
    <a href="index.html" class="back-button">← Back</a>
    <div class="label">3D Earth — drag to rotate, scroll to zoom</div>
  </div>

  <div id="canvas-container"></div>

  <!-- Three.js (module build) + OrbitControls -->
  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.152.2/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.152.2/examples/jsm/controls/OrbitControls.js';

    // --- Scene, camera, renderer ---
    const container = document.getElementById('canvas-container');
    const scene = new THREE.Scene();

    // subtle ambient fog (gives depth)
    scene.fog = new THREE.FogExp2(0x000000, 0.0004);

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setPixelRatio(window.devicePixelRatio || 1);
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    container.appendChild(renderer.domElement);

    const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 2000);
    camera.position.set(0, 1.4, 4);

    // Controls
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.08;
    controls.minDistance = 1.6;
    controls.maxDistance = 12;
    controls.autoRotate = false; // set true if you want auto-rotation
    controls.rotateSpeed = 0.6;

    // --- Lights ---
    const ambient = new THREE.AmbientLight(0xffffff, 0.25);
    scene.add(ambient);

    const sun = new THREE.DirectionalLight(0xffffff, 1.2);
    sun.position.set(5, 0, 5);
    scene.add(sun);

    // optional small rim light to lighten night side a bit
    const rim = new THREE.DirectionalLight(0x99ccff, 0.12);
    rim.position.set(-3, 0.5, -2);
    scene.add(rim);

    // --- Earth mesh ---
    const RADIUS = 1;
    const geometry = new THREE.SphereGeometry(RADIUS, 64, 64);

    // Load textures (use your local files in assets/)
    const loadingManager = new THREE.LoadingManager();
    const loader = new THREE.TextureLoader(loadingManager);

    const colorMap = loader.load('assets/2k_earth_daymap.jpg');
    const normalMap = loader.load('assets/2k_earth_nightmap.jpg'); // optional
    const specMap = loader.load('assets/2k_earth_clouds.jpg');     // optional

    // ensure correct color space
    colorMap.encoding = THREE.sRGBEncoding;

    const earthMaterial = new THREE.MeshPhongMaterial({
      map: colorMap,
      normalMap: normalMap || null,
      specularMap: specMap || null,
      shininess: 10,
      specular: new THREE.Color(0x333333),
    });

    const earth = new THREE.Mesh(geometry, earthMaterial);
    earth.rotation.z = THREE.MathUtils.degToRad(23.4); // tilt for realism
    scene.add(earth);

    // --- Cloud layer (subtle, optional) ---
    const cloudGeometry = new THREE.SphereGeometry(RADIUS * 1.01, 64, 64);
    const cloudMaterial = new THREE.MeshLambertMaterial({
      map: loader.load('assets/earth-clouds.png'), // optional: semi-transparent cloud map
      transparent: true,
      opacity: 0.9,
      depthWrite: false
    });
    // only add cloud layer if clouds image exists; wrap in try/catch by checking URL load
    let clouds = null;
    loadingManager.onLoad = () => {
      // if the clouds texture file doesn't exist, this will simply not be used
      try {
        if (cloudMaterial.map && cloudMaterial.map.image) {
          clouds = new THREE.Mesh(cloudGeometry, cloudMaterial);
          clouds.rotation.z = earth.rotation.z;
          scene.add(clouds);
        }
      } catch (e) {}
    };

    // --- Starfield (points) ---
    function makeStars(count = 4000, radius = 80) {
      const positions = new Float32Array(count * 3);
      for (let i = 0; i < count; i++) {
        const phi = Math.acos(2 * Math.random() - 1);
        const theta = 2 * Math.PI * Math.random();
        const r = radius * (0.7 + 0.3 * Math.random());
        const x = r * Math.sin(phi) * Math.cos(theta);
        const y = r * Math.sin(phi) * Math.sin(theta);
        const z = r * Math.cos(phi);
        positions[i * 3 + 0] = x;
        positions[i * 3 + 1] = y;
        positions[i * 3 + 2] = z;
      }
      const g = new THREE.BufferGeometry();
      g.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      const mat = new THREE.PointsMaterial({ size: 0.06, sizeAttenuation: true, color: 0xffffff, opacity: 0.9, transparent: true });
      const pts = new THREE.Points(g, mat);
      scene.add(pts);
    }
    makeStars();

    // --- handle resize ---
    function onWindowResize() {
      const w = container.clientWidth;
      const h = container.clientHeight;
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
      renderer.setSize(w, h);
    }
    window.addEventListener('resize', onWindowResize, false);

    // --- animation loop ---
    const ROTATION_SPEED = 0.0035; // radians per frame (tweak)
    function animate() {
      requestAnimationFrame(animate);

      // rotate earth slowly (eastwards)
      earth.rotation.y += ROTATION_SPEED;

      if (clouds) clouds.rotation.y += ROTATION_SPEED * 1.12;

      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    // --- basic cleanup if you ever navigate away (optional) ---
    window.addEventListener('unload', () => {
      renderer.dispose();
    });

  </script>
</body>
</html>
